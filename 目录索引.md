# BLE文件传输协议设计文档 - 目录索引

## 📋 文档概览
- **协议版本**: v1.0
- **设计日期**: 2025-01-27
- **适用产品**: 电子吧唧产品
- **支持文件类型**: 图片、视频、GIF

---

## 📚 目录索引

### 1. [协议概述](#1-协议概述)
- [1.1 协议特点](#11-协议特点)
- [1.2 传输文件类型](#12-传输文件类型)

### 2. [数据包格式](#2-数据包格式)
- [2.1 整体数据包结构](#21-整体数据包结构)
- [2.2 数据包头部格式 (3 bytes)](#22-数据包头部格式-3-bytes)

### 3. [数据部分格式](#3-数据部分格式)
- [3.1 数据部分结构](#31-数据部分结构)
- [3.2 命令ID格式 (2 bytes)](#32-命令id格式-2-bytes)

### 4. [功能模块定义](#4-功能模块定义)
- [4.1 三级Key结构说明](#41-三级key结构说明)
- [4.2 第二级Key定义](#42-第二级key定义)

#### 4.3 [FILE_TRANSFER (0x01) - 文件传输功能](#43-file_transfer-0x01---文件传输功能)
- [4.3.1 传输准备阶段命令](#431-传输准备阶段命令)
- [4.3.2 数据传输阶段命令](#432-数据传输阶段命令)
- [4.3.3 开始传输时携带的文件信息](#433-开始传输时携带的文件信息)
- [4.3.4 数据传输过程中的信息](#434-数据传输过程中的信息)
- [4.3.5 文件完整性最终验证](#435-文件完整性最终验证)

#### 4.4 [MEDIA_MANAGEMENT (0x02) - 媒体管理功能](#44-media_management-0x02---媒体管理功能)
- [4.4.1 媒体管理命令](#441-媒体管理命令)
- [4.4.2 媒体列表响应协议实现](#442-媒体列表响应协议实现)
- [4.4.3 媒体删除协议实现](#443-媒体删除协议实现)
- [4.4.4 媒体信息查询协议实现](#444-媒体信息查询协议实现)
- [4.4.5 媒体预览图协议实现](#445-媒体预览图协议实现)
- [4.4.6 预览图推送协议实现](#446-预览图推送协议实现)
- [4.4.7 背景图协议实现](#447-背景图协议实现)
- [4.4.8 预览图和背景图推送协议流程图](#448-预览图和背景图推送协议流程图)
- [4.4.9 媒体ID分配协议实现](#449-媒体id分配协议实现)

#### 4.5 [SYSTEM_INFO (0x03) - 系统信息功能](#45-system_info-0x03---系统信息功能)
- [4.5.1 设备信息请求协议实现](#451-设备信息请求协议实现)
- [4.5.2 设备信息响应协议实现](#452-设备信息响应协议实现)

### 5. [文件传输流程](#5-文件传输流程)
- [5.1 详细文件传输流程图](#51-详细文件传输流程图)
- [5.2 错误处理流程](#52-错误处理流程)
- [5.3 暂停/恢复流程](#53-暂停恢复流程)
- [5.4 状态查询流程](#54-状态查询流程)
- [5.5 设备信息获取流程 (升级前)](#55-设备信息获取流程-升级前)

### 6. [数据包示例](#6-数据包示例)
- [6.1 单文件传输示例](#61-单文件传输示例)
- [6.2 传输拒绝示例 (存储空间不足)](#62-传输拒绝示例-存储空间不足)
- [6.3 设备信息获取示例 (屏幕信息)](#63-设备信息获取示例-屏幕信息)
- [6.4 状态查询示例](#64-状态查询示例)
- [6.5 数据块传输与校验和验证示例](#65-数据块传输与校验和验证示例)

### 7. [文件类型定义](#7-文件类型定义)
- [7.1 支持的文件类型](#71-支持的文件类型)

### 8. [错误代码定义](#8-错误代码定义)
- [8.1 传输错误代码](#81-传输错误代码)

### 9. [实现建议](#9-实现建议)
- [9.1 数据块大小建议](#91-数据块大小建议)
- [9.2 传输优化](#92-传输优化)

### 10. [协议总结](#10-协议总结)
- [10.1 核心特点](#101-核心特点)
- [10.2 使用场景](#102-使用场景)
- [10.3 协议优势](#103-协议优势)

---

## 🔧 快速导航

### 核心功能模块
- **文件传输**: [FILE_TRANSFER (0x01)](#43-file_transfer-0x01---文件传输功能)
- **媒体管理**: [MEDIA_MANAGEMENT (0x02)](#44-media_management-0x02---媒体管理功能)
- **系统信息**: [SYSTEM_INFO (0x03)](#45-system_info-0x03---系统信息功能)

### 重要流程
- **完整传输流程**: [详细文件传输流程图](#51-详细文件传输流程图)
- **错误处理**: [错误处理流程](#52-错误处理流程)
- **状态查询**: [状态查询流程](#54-状态查询流程)

### 实现参考
- **数据包示例**: [数据包示例](#6-数据包示例)
- **CRC32算法**: [CHECKSUM校验码算法说明](#checksum校验码算法说明)
- **实现建议**: [实现建议](#9-实现建议)

### 协议规范
- **数据包格式**: [数据包格式](#2-数据包格式)
- **命令定义**: [功能模块定义](#4-功能模块定义)
- **错误代码**: [错误代码定义](#8-错误代码定义)

---

## 📖 使用说明

1. **点击目录项**: 直接跳转到对应章节
2. **快速导航**: 使用快速导航区域快速定位核心功能
3. **协议学习**: 建议按顺序阅读，从概述到具体实现
4. **开发参考**: 重点关注数据包示例和实现建议部分

---

*最后更新: 2025-01-27*
*文档版本: v1.0*
